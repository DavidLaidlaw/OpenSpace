local assetHelper = asset.require('util/asset_helper')
local sceneHelper = asset.require('util/scene_helper')

-- Specifying which other assets should be loaded in this scene
asset.require('spice/base')

assetHelper.requestAll(asset, 'scene/solarsystem/sun')
-- assetHelper.requestAll(asset, 'scene/solarsystem/planets')
local earthAsset = asset.require('scene/solarsystem/planets/earth/earth')
asset.require('scene/solarsystem/planets/earth/moon/moon')

-- Add everything from DU
assetHelper.requestAll(asset, 'scene/digitaluniverse')

asset.request('scene/milkyway/gaia/gaiamission')
asset.request('scene/milkyway/gaia/abundance')
asset.request('scene/milkyway/gaia/exoplanets_hypatia')

-- Load default key bindings applicable to most scenes
asset.require('util/default_keybindings')
asset.require('util/default_dashboard')

-- Custom Keybindings
local Keybindings = {
    {
        Key = "g",
        Command = "openspace.setPropertyValue('NavigationHandler.Origin', 'GaiaModel')",
        Documentation = "Sets the focus of the camera to the 'GaiaModel'.",
        Local = false
    },
    {
        Key = "e",
        Command = "openspace.setPropertyValue('NavigationHandler.Origin', 'Earth')",
        Documentation = "Sets the focus of the camera to 'Earth'.",
        Local = false
    },
    {
        Key = "KP_1",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Hypatia.renderable.OtherDataValueRange', { -0.25, 0.2 });
        openspace.setPropertyValue('Scene.Stars_Galah.renderable.OtherDataValueRange', { -0.8, 0.6 });
        openspace.setPropertyValue('Scene.Stars_Apogee.renderable.OtherDataValueRange', { -0.8, 0.6 });
        ]],
        Documentation = "Set values for FeH for Apogee/Galah/Hypatia",
        Local = false
    },
    {
        Key = "KP_2",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Galah.renderable.OtherDataValueRange', { -0.2, 0.6 });
        openspace.setPropertyValue('Scene.Stars_Apogee.renderable.OtherDataValueRange', { -0.2, 0.6 });
        ]],
        Documentation = "Set values for MgFe and alphaFe for Apogee/Galah",
        Local = false
    },
    {
        Key = "KP_3",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Galah.renderable.OtherDataValueRange', { -0.15, 0.6 });
        openspace.setPropertyValue('Scene.Stars_Apogee.renderable.OtherDataValueRange', { -0.15, 0.6 });
        ]],
        Documentation = "Set values for AlFe for Apogee/Galah",
        Local = false
    },
    {
        Key = "KP_4",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Galah.renderable.OtherDataValueRange', { -0.1, 1.5 });
        openspace.setPropertyValue('Scene.Stars_Apogee.renderable.OtherDataValueRange', { -0.1, 1.5 });
        ]],
        Documentation = "Set values for MgAl for Apogee/Galah",
        Local = false
    },
    {
        Key = "KP_5",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Galah.renderable.OtherDataValueRange', { -0.15, 0.2 });
        openspace.setPropertyValue('Scene.Stars_Apogee.renderable.OtherDataValueRange', { -0.15, 0.2 });
        ]],
        Documentation = "Set values for aexahyd for Apogee/Galah",
        Local = false
    },
    {
        Key = "KP_6",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Galah.renderable.OtherDataValueRange', { -0.6, 0.6 });
        openspace.setPropertyValue('Scene.Stars_Apogee.renderable.OtherDataValueRange', { -0.6, 0.5 });
        ]],
        Documentation = "Set values for NaO for Apogee/Galah",
        Local = false
    },
    {
        Key = "KP_7",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Hypatia.renderable.OtherDataValueRange', { -0.25, 0.15 });
        ]],
        Documentation = "Set values for CH for Hypatia",
        Local = false
    },
    {
        Key = "KP_8",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Hypatia.renderable.OtherDataValueRange', { -0.25, 0.13 });
        ]],
        Documentation = "Set values for OH for Hypatia",
        Local = false
    },
    {
        Key = "KP_9",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Hypatia.renderable.OtherDataValueRange', { -0.15, 0.15 });
        ]],
        Documentation = "Set values for NaH for Hypatia",
        Local = false
    },
    {
        Key = "KP_0",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Hypatia.renderable.OtherDataValueRange', { -0.1, 0.2 });
        ]],
        Documentation = "Set values for AlH for Hypatia",
        Local = false
    },
    {
        Key = "Shift+KP_1",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Hypatia.renderable.OtherDataValueRange', { -0.2, 0.7 });
        ]],
        Documentation = "Set values for BeFe for Galah",
        Local = false
    },
    {
        Key = "Shift+KP_2",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Hypatia.renderable.OtherDataValueRange', { -0.4, 0.6 });
        ]],
        Documentation = "Set values for EuFe for Galah",
        Local = false
    },
    {
        Key = "Shift+KP_3",
        Command = [[
        openspace.setPropertyValue('Scene.Stars_Hypatia.renderable.OtherDataValueRange', { -0.8, 0.9 });
        ]],
        Documentation = "Set values for BaEu for Galah",
        Local = false
    }
}

local GaiaModelAsset = asset.require('scene/milkyway/gaia/gaiamodel')
asset.require('scene/milkyway/gaia/trail')

assetHelper.registerDashboardItems(asset, {
    {
        Type = "DashboardItemDistance",
        Identifier = "GaiaModelEarthDistance",
        GuiName = "GaiaModel Earth Distance",
        SourceType = "Node",
        SourceNodeName = "GaiaModel",
        DestinationType = "Node Surface",
        DestinationNodeName = "Earth"
    }
})

asset.onInitialize(function ()
    openspace.time.setTime(openspace.time.currentWallTime())
    sceneHelper.bindKeys(Keybindings)
    
    openspace.setDefaultGuiSorting()

    openspace.markInterestingNodes({
       "GaiaModel", "Earth", "Sun"
    })

    openspace.addVirtualProperty(
        "BoolProperty",
        "Show Trails",
        "*Trail.renderable.Enabled",
        "Disable or enable all trails of the scene at the same time",
        true,
        nil,
        nil
    )

    openspace.navigation.setCameraState({
        Focus = earthAsset.Earth.Identifier,
        Position = { 100000000.0, 100000000.0, 100000000.0 },
        Rotation = { 0.758797, 0.221490, -0.605693, -0.091135 },
    })


    -- For the AMNH Gaia Sprint event
    openspace.setPropertyValueSingle('RenderEngine.ShowLog', false);
    openspace.setPropertyValueSingle('Scene.OpenStarClusters.renderable.Transparency', 0.3);
    openspace.setPropertyValueSingle('Scene.OpenStarClusters.renderable.ScaleFactor', 400.0);
    openspace.setPropertyValueSingle('Scene.OpenStarClusters.renderable.TextSize', 15.5);
    openspace.setPropertyValueSingle('Scene.GlobularClusters.renderable.ScaleFactor', 400.0);
    openspace.setPropertyValueSingle('Scene.GlobularClusters.renderable.Transparency', 0.45);
    openspace.setPropertyValueSingle('Scene.GlobularClusters.renderable.TextSize', 16.5);
    openspace.setPropertyValueSingle('Scene.GlobularClusters.renderable.BillboardMaxSize', 530.0);
    openspace.setPropertyValueSingle('Scene.OBAssociations.renderable.ScaleFactor', 400.0);

    openspace.setPropertyValueSingle('Scene.Stars.renderable.UsePSFTexture', false);

    openspace.setPropertyValueSingle('Scene.Stars_Apogee.renderable.UsePSFTexture', false);
    openspace.setPropertyValueSingle('Scene.Stars_Apogee.renderable.OtherDataColorMap', [[F:/Gaia/GaiaAbundApogee/RainbowGradient.cmap]]);
    openspace.setPropertyValueSingle('Scene.Stars_Apogee.renderable.ColorOption', 3);
    openspace.setPropertyValueSingle('Scene.Stars_Apogee.renderable.ScaleFactor', 8.0);
    openspace.setPropertyValueSingle('Scene.Stars_Apogee.renderable.OtherDataValueRange', {-0.5,0.5});

    openspace.setPropertyValueSingle('Scene.Stars_Galah.renderable.UsePSFTexture', false);
    openspace.setPropertyValueSingle('Scene.Stars_Galah.renderable.OtherDataColorMap', [[F:/Gaia/GaiaAbundGalah/RainbowGradient.cmap]]);
    openspace.setPropertyValueSingle('Scene.Stars_Galah.renderable.ColorOption', 3);
    openspace.setPropertyValueSingle('Scene.Stars_Galah.renderable.ScaleFactor', 12.0);
    openspace.setPropertyValueSingle('Scene.Stars_Galah.renderable.OtherDataValueRange', {-0.5,0.5});


    openspace.setPropertyValueSingle('Scene.Stars_Hypatia.renderable.UsePSFTexture', false);
    openspace.setPropertyValueSingle('Scene.Stars_Hypatia.renderable.OtherDataColorMap', [[F:/Gaia/GaiaHypatia/RainbowGradient.cmap]]);
    openspace.setPropertyValueSingle('Scene.Stars_Hypatia.renderable.ColorOption', 3);
    openspace.setPropertyValueSingle('Scene.Stars_Hypatia.renderable.ScaleFactor', 6.0);
    openspace.setPropertyValueSingle('Scene.Stars_Hypatia.renderable.OtherDataValueRange', {-0.5,0.5});
end)

-- Remove interesting nodes and added virtual properties
asset.onDeinitialize(function ()
    sceneHelper.unbindKeys(Keybindings)

    openspace.removeVirtualProperty("*Trail.renderable.Enabled")
    openspace.removeInterestingNodes({
        "GaiaModel", "Earth", "Sun"
    })
end)
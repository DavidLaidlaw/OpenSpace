local assetHelper = asset.require('util/asset_helper')
local sunTransforms = asset.require('scene/solarsystem/sun/transforms')
asset.require('spice/base')

local models = asset.syncedResource({
    Name = "Apollo Models",
    Type = "HttpSynchronization",
    Identifier = "apollo_models",
    Version = 1
})

local kernels = asset.syncedResource({
    Name = "Apollo Kernels",
    Type = "HttpSynchronization",
    Identifier = "apollo_spice",
    Version = 1
})


local LocalKernels = {
    kernels .. '/apollo8.bsp'
}

local LightSources = {
    {
        Type = "SceneGraphLightSource",
        Identifier = "Sun",
        Node = sunTransforms.SolarSystemBarycenter.Identifier,
        Intensity = 1.0
    },
    -- {
    --     Identifier = "Camera",
    --     Type = "CameraLightSource",
    --     Intensity = 0.5
    -- }
}


local Apollo_8_CSM = {
    Identifier = "Apollo8CSM",
    Parent = "Moon",
    Transform = {
        Translation = {
            Type = "SpiceTranslation",
            Target = "-908",
            Observer = "MOON",
            Frame = "IAU_MOON",
            Kernels = LocalKernels
        }
    },
    Renderable = {
        Type = "RenderableModel",
        Geometry = {
            Type = "MultiModelGeometry",
            GeometryFile = models .. "/Apollo_CSM_shrunk_rotated_xy_doubble_size.obj"
        },
        ColorTexture = models .. "/gray.png",
        LightSources = LightSources

        --ModelTransform = RotationMatrix
    },
    GUI = {
        Name = "Apollo 8 CSM",
        Path = "/Solar System/Missions/Apollo"
    }
}

-- local Apollo_8_CSM_Model = {
--     Identifier = "Apollo_8_CSM_model",
--     Parent = Apollo_8_CSM.Identifier,
--     Renderable = {
--         Type = "RenderableModel",
--         Geometry = {
--             Type = "MultiModelGeometry",
--             GeometryFile = mmodels .. "/MessengerProbe_black.obj"
--         },
--         --ColorTexture = models .. "/gray.png",
--         ColorTexture = mmodels .. "/Tex_black.png",

--         --ModelTransform = RotationMatrix
--     }
-- }

local Apollo_8_Trail = {
    Identifier = "Apollo8Trail",
    Parent = "Moon",
    Renderable = {
        Type = "RenderableTrailTrajectory",
        Translation = {
            Type = "SpiceTranslation",
            Target = "-908",
            Observer = "MOON",
            Frame = "IAU_MOON",            
            Kernels = LocalKernels
        },
        Color = { 0.70, 0.50, 0.20 },
        StartTime = "1968 DEC 21",
        EndTime = "1968 DEC 28",
        SampleInterval = 30
    },
    GUI = {
        Name = "Apollo 8 Trail",
        Path = "/Solar System/Missions/Apollo"
    }
}

assetHelper.registerSceneGraphNodesAndExport(asset, { Apollo_8_CSM, Apollo_8_Trail })